<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>kenstant的博客</title>
    <meta name="description" content="kenstant的博客">
    <meta name="generator" content="VitePress v2.0.0-alpha.16">
    <link rel="preload stylesheet" href="/blogs/assets/style.B4PWJrCz.css" as="style">
    <link rel="preload stylesheet" href="/blogs/vp-icons.css" as="style">
    
    <script type="module" src="/blogs/assets/app.CM0tDhzG.js"></script>
    <link rel="preload" href="/blogs/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/blogs/assets/chunks/theme.DJQ3o67N.js">
    <link rel="modulepreload" href="/blogs/assets/chunks/framework.6-m_a-od.js">
    <link rel="modulepreload" href="/blogs/assets/tech-learning_Web3_北大肖臻《区块链技术与应用》_笔记03-BTC-数据结构.md.CPnbZdkJ.lean.js">
    <link rel="icon" href="/blogs/icons/favicon.ico">
    <link rel="icon" type="image/png" sizes="16x16" href="/blogs/icons/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/blogs/icons/favicon-32x32.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/blogs/icons/apple-touch-icon.png">
    <link rel="manifest" href="/blogs/icons/site.webmanifest">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-8e410b79><!--[--><!--]--><!--[--><span tabindex="-1" data-v-be48d319></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-be48d319>Skip to content</a><!--]--><!----><header class="VPNav" data-v-8e410b79 data-v-46d25293><div class="VPNavBar top" data-v-46d25293 data-v-ddefa081><div class="wrapper" data-v-ddefa081><div class="container" data-v-ddefa081><div class="title" data-v-ddefa081><div class="VPNavBarTitle" data-v-ddefa081 data-v-4218a31a><a class="title" href="/blogs/" data-v-4218a31a><!--[--><!--]--><!----><span data-v-4218a31a>kenstant的博客</span><!--[--><!--]--></a></div></div><div class="content" data-v-ddefa081><div class="content-body" data-v-ddefa081><!--[--><!--]--><div class="VPNavBarSearch search" data-v-ddefa081 data-v-c6b1e06a><!--[--><button type="button" class="VPNavBarSearchButton" aria-label="Search" aria-keyshortcuts="/ control+k meta+k" data-v-c6b1e06a data-v-ef676460><span class="vpi-search" aria-hidden="true" data-v-ef676460></span><span class="text" data-v-ef676460>Search</span><span class="keys" aria-hidden="true" data-v-ef676460><kbd class="key-cmd" data-v-ef676460>⌘</kbd><kbd class="key-ctrl" data-v-ef676460>Ctrl</kbd><kbd data-v-ef676460>K</kbd></span></button><!----><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-ddefa081 data-v-b5c5c4dc><span id="main-nav-aria-label" class="visually-hidden" data-v-b5c5c4dc> Main Navigation </span><!--[--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-ddefa081 data-v-4c439896><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-4c439896 data-v-e7985c94 data-v-ad1bd3fa><span class="check" data-v-ad1bd3fa><span class="icon" data-v-ad1bd3fa><!--[--><span class="vpi-sun sun" data-v-e7985c94></span><span class="vpi-moon moon" data-v-e7985c94></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-ddefa081 data-v-61ed4e50 data-v-10b1d303><!--[--><a class="VPSocialLink no-icon" href="https://github.com/kenstant" aria-label="github" target="_blank" rel="me noopener" data-v-10b1d303 data-v-22b9c8b5><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-ddefa081 data-v-12e31893 data-v-db8b1fc3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-db8b1fc3><span class="vpi-more-horizontal icon" data-v-db8b1fc3></span></button><div class="menu" data-v-db8b1fc3><div class="VPMenu" data-v-db8b1fc3 data-v-70413b0b><!----><!--[--><!--[--><!----><div class="group" data-v-12e31893><div class="item appearance" data-v-12e31893><p class="label" data-v-12e31893>Appearance</p><div class="appearance-action" data-v-12e31893><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-12e31893 data-v-e7985c94 data-v-ad1bd3fa><span class="check" data-v-ad1bd3fa><span class="icon" data-v-ad1bd3fa><!--[--><span class="vpi-sun sun" data-v-e7985c94></span><span class="vpi-moon moon" data-v-e7985c94></span><!--]--></span></span></button></div></div></div><div class="group" data-v-12e31893><div class="item social-links" data-v-12e31893><div class="VPSocialLinks social-links-list" data-v-12e31893 data-v-10b1d303><!--[--><a class="VPSocialLink no-icon" href="https://github.com/kenstant" aria-label="github" target="_blank" rel="me noopener" data-v-10b1d303 data-v-22b9c8b5><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-ddefa081 data-v-0068b816><span class="container" data-v-0068b816><span class="top" data-v-0068b816></span><span class="middle" data-v-0068b816></span><span class="bottom" data-v-0068b816></span></span></button></div></div></div></div><div class="divider" data-v-ddefa081><div class="divider-line" data-v-ddefa081></div></div></div><!----></header><div class="VPLocalNav empty fixed" data-v-8e410b79 data-v-ce6f96dc><div class="container" data-v-ce6f96dc><!----><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-ce6f96dc data-v-9b0a0265><button data-v-9b0a0265>返回顶部</button><!----></div></div></div><!----><div class="VPContent" id="VPContent" data-v-8e410b79 data-v-1321b454><div class="VPDoc has-aside" data-v-1321b454 data-v-d30c2b42><!--[--><!--]--><div class="container" data-v-d30c2b42><div class="aside" data-v-d30c2b42><div class="aside-curtain" data-v-d30c2b42></div><div class="aside-container" data-v-d30c2b42><div class="aside-content" data-v-d30c2b42><div class="VPDocAside" data-v-d30c2b42 data-v-9a6af9f7><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-9a6af9f7 data-v-b72904b0><div class="content" data-v-b72904b0><div class="outline-marker" data-v-b72904b0></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-b72904b0>On this page</div><ul class="VPDocOutlineItem root" data-v-b72904b0 data-v-835de44b><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-9a6af9f7></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-d30c2b42><div class="content-container" data-v-d30c2b42><!--[--><!--]--><main class="main" data-v-d30c2b42><div style="position:relative;" class="vp-doc _blogs_tech-learning_Web3_%E5%8C%97%E5%A4%A7%E8%82%96%E8%87%BB%E3%80%8A%E5%8C%BA%E5%9D%97%E9%93%BE%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%BA%94%E7%94%A8%E3%80%8B_%E7%AC%94%E8%AE%B003-BTC-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84 external-link-icon-enabled" data-v-d30c2b42><div><h2 id="重要概念" tabindex="-1">重要概念 <a class="header-anchor" href="#重要概念" aria-label="Permalink to “重要概念”">​</a></h2><ul><li><code>hash pointers</code>（哈希指针） <ul><li>一般的指针存放的是结构体在内存中的起始位置。</li><li>哈希指针除了要存结构体的地址之外，还要保存这个结构体的哈希值。</li><li>这样做的好处是： <ul><li>不光可以找到这个结构体的位置</li><li>还可以知道这个结构体的内容有没有被篡改</li></ul></li><li>其他用处：只要不成环，都可以用到哈希指针。如果成环，会产生循环依赖，最后哪个区块都无法定下来。</li></ul></li><li>比特币中最基本的数据结构：<code>区块链</code>和<code>Merkle tree</code>。 <ul><li>区块链是什么？ <ul><li>就是一个一个区块组成的链表。</li><li>Block chain is a linked list using hash pointers.</li></ul></li><li>区块链和普通链表的区别： <ul><li>用哈希指针代替了普通的指针。</li><li>普通链表可以改变其中任何一个元素，而对其他元素没有影响。但是区块链中任何一个元素发生更改，都会导致其后所有元素发生更改。</li></ul></li></ul></li><li><code>Merkle tree（默克尔树）</code>： <ul><li>和<code>Binary tree</code>的区别： <ul><li>用哈希指针代替了普通的指针。</li><li>和区块链一样，任何一个数据节点的内容发生更改，都会导致根节点的hash值与系统中保存的对不上。</li></ul></li></ul></li></ul><p><img src="/blogs/assets/image-20241229120314099.DgAPIC9n.png" alt="image-20241229120314099"></p><h2 id="区块链的数据结构" tabindex="-1">区块链的数据结构 <a class="header-anchor" href="#区块链的数据结构" aria-label="Permalink to “区块链的数据结构”">​</a></h2><ul><li><p>第一个区块叫做：创世纪块，genesis block。</p></li><li><p>最后一个区块是最近产生的区块：most recent block。</p></li><li><p>每个区块都包含指向前一个区块的哈希指针。所以里面都有一个小的hash pointer。</p></li><li><p>最后一个区块也有一个hash pointer，保存在系统里。</p></li><li><p>hash pointer的值，是把前面一个区块的整个内容，包括里面的hash pointer，合在里面一起取hash。</p></li><li><p>通过这样的数据结构可以实现<code>tamper-evident log（篡改证明记录）</code>。</p><ul><li>链中任何一个区块发生了改动，都会导致其后的每一个哈希指针的值变化，最后一个保存在系统中的哈希指针的值也会变化，由此便可知道发生了改动。</li></ul></li><li><p>所以这样的数据结构的好处是：</p><ul><li>只要保存最后一个哈希指针的值，就可以检测出对区块链中任何一个部位的修改。</li><li>有了这个性质，比特币中有些节点就不用保存整条区块链上的节点，可以只保存最近的几千个节点。如果要用到以前的节点，可以再问系统中的其他节点去要这个区块。</li><li>有些节点可能是有恶意的，这是一个去中心化的系统，你怎么知道别人给你的区块是不是正确的。只需要找别的节点拿到最后的区块，计算其哈希值，是否和我保存在开头的区块的哈希值是否一致即可。</li></ul></li><li><p>比特币中最后一个数据结构是：<code>Merkle tree</code></p></li><li><p>比特币当中各个区块之间用哈希指针连接在一起的，每个区块所包含的交易，是组织成一个<code>Merkle tree</code>的形式，底下的每个数据块实际上是一个交易（transaction）。</p></li><li><p>每个区块分为两部分，分为块头（<code>block header</code>）和块身（<code>block body</code>），在<code>block header</code>里面保存了<code>root hash（根哈希值）</code>，就这个区块所包含的所有交易组成的<code>Merkle tree</code>的根哈希值是存在这个区块的<code>block header</code>里面，但<code>block header</code>里面没有具体交易，只有<code>根哈希值</code>。<code>block body</code>里面是有交易的列表的。</p></li><li><p><code>Merkle tree</code>的用途：</p><ol><li>提供<code>Merkle proof</code>。比特币中的节点分为两类，全节点和轻节点。全节点是保存整个区块的内容，有<code>block header</code>和<code>block body</code>。轻节点，像手机上的比特币钱包应用，就只保存了<code>block header</code>。下面是<code>Merkle proof</code>示意图。</li></ol><p><img src="/blogs/assets/image-20241229123209275.BeWvmyv_.png" alt="image-20241229123209275"></p></li><li><p>轻节点如何知道一笔交易已经被写入到区块链中了？怎么去做校验呢？用到<code>Merkle proof</code>，过程如下</p><ul><li>轻节点向一个全节点发出请求，全节点返回3个红色的哈希值。</li><li>轻节点本地计算出标黄的交易的哈希值（绿色），然后和全节点返回的红色哈希值再进行计算，逐层计算，最后得到整棵树的根哈希值。</li><li>轻节点将计算得到的根哈希值，与<code>block header</code>里的根哈希值比较一下，就能知道这个黄色交易是不是在<code>Merkle tree</code>里面了。全节点在<code>Merkle proof</code>里提供的这几个哈希值，就是从黄色交易所在的叶节点的位置到树根的路径上用到的这些哈希值。</li><li>引申一点，如果旁边的节点被更改了，必定要更改其哈希值，最后整个根节点不对，无法验证黄色交易成功。如果旁边节点被更改，要人为制造一个哈希碰撞，使被更改交易的上一层节点的哈希值不变，这个在理论上可行，但实际上不可行，这是由<code>collision resistance</code>性质保证的，最后也无法验证黄色交易成功。</li><li>放在实际场景中，全节点为什么要向轻节点提供一个验证失败的哈希值呢？考虑这样一个例子，A对B说，我完成了交易你要发货了。B要A证明交易成功，结果A提供的证明用例，无法证明A的交易是成功的，那对B来说，A的交易没成功，B自然也不会发货。</li><li>上述的<code>Merkle proof</code>可以证明，<code>Merkle tree</code>里面包含了某个交易。所以这种交易又叫做<code>proof of membership</code>或者叫<code>proof of inclusion</code>。</li><li>对于轻节点来说，要验证一个<code>Merkle proof</code>的复杂度：若最底下层有n个交易，则复杂度是对数级别 <code>log(n)</code>，是比较高效的。</li><li>能不能证明不包含某个交易呢？即<code>proof of non-membership</code>。</li><li>有一个最简单但笨的方法，把整棵树传给轻节点，轻节点收到之后验证整个树的构造都是对的，每一层的哈希值都是正确的，说明树里只有这些叶子节点，没有别的，要找的交易不在这个树里面，即可。但复杂度是<code>n</code>，比较复杂。如果对叶节点不做任何排序要求，那么就没有更高效的方法了。</li><li>如果对叶节点有排序要求，则，对每个叶节点取一次hash，然后按照哈希值从小到大排序，有个好的证明方法，我要查的那个交易，先算出其hash，然后就可以知道大概在哪个位置（即所在节点范围），然后验证其所在范围的两个叶节点往上的所有哈希值如果正确的，就可以说明这两个节点在原来的Merkle tree中确实是相邻的节点，要找的交易如果存在，应该是插在这两个之间的，但是它没有出现，所以就是不存在。复杂度也是<code>log(n)</code>，代价就是要排个序。这种排好序的叫做<code>sorted merkle tree</code>。</li><li>比特币中没有用到<code>sorted merkle tree</code>，因为比特币中不需要做这种<code>不存在证明</code>。</li></ul></li></ul></div></div></main><footer class="VPDocFooter" data-v-d30c2b42 data-v-6d6b3e6e><!--[--><!--]--><div class="edit-info" data-v-6d6b3e6e><!----><div class="last-updated" data-v-6d6b3e6e><p class="VPLastUpdated" data-v-6d6b3e6e data-v-17f12ee2>上次更新时间: <time datetime="2025-11-30T14:36:26.000Z" data-v-17f12ee2></time></p></div></div><!----></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter" data-v-8e410b79 data-v-e121ba62><div class="container" data-v-e121ba62><p class="message" data-v-e121ba62>我与我周旋久，宁做我</p><p class="copyright" data-v-e121ba62>Copyright © 2025</p></div></footer><!--[--><div class="back-button-floating"><div class="floating-ball"><span class="back-icon">←</span><span class="back-text">返回</span></div></div><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"drafts_index.md\":\"Ck7PHTEk\",\"english_index.md\":\"BgnHkeOC\",\"english_常用短语.md\":\"CUFSO8t_\",\"english_语法.md\":\"C7mPbqeq\",\"index.md\":\"SQ4xG-we\",\"investment_index.md\":\"DMgqkC_G\",\"investment_经验教训.md\":\"CJkGG2hc\",\"investment_预案_操作预案.md\":\"Bz_O_G8W\",\"reading-notes_index.md\":\"DqGKQVnO\",\"reading-notes_《大话设计模式》_01-uml.md\":\"YM0DaF-L\",\"reading-notes_《大话设计模式》_02-简单工厂模式.md\":\"CqxM45id\",\"reading-notes_《大话设计模式》_03-策略模式.md\":\"WdfH7nnC\",\"reading-notes_《大话设计模式》_index.md\":\"1uwTb12m\",\"tech-learning_build-blog_index.md\":\"Bi1khc3y\",\"tech-learning_build-blog_使用vuepress搭建博客.md\":\"C3t0pO4o\",\"tech-learning_build-blog_使用vuepress默认主题.md\":\"eA7cIEo2\",\"tech-learning_build-blog_将博客部署到github pages.md\":\"CMUog2WQ\",\"tech-learning_index.md\":\"NqJRs96t\",\"tech-learning_java_index.md\":\"CnOdj_Y3\",\"tech-learning_java_jdk21-virtual-threads-intro.md\":\"CcfjoIWo\",\"tech-learning_java_maven-wrapper.md\":\"Du8RhHd9\",\"tech-learning_practice_index.md\":\"0Ysv7X8O\",\"tech-learning_practice_redis批量删除固定前缀key.md\":\"DlLRQZRF\",\"tech-learning_practice_具体问题列表.md\":\"BcdxE0mS\",\"tech-learning_practice_接口耗时问题排查.md\":\"BGPVcYWR\",\"tech-learning_practice_积分消费日志表数据迁移.md\":\"ZV_VSquq\",\"tech-learning_practice_网络连接相关问题排查.md\":\"lVJaX0Q0\",\"tech-learning_web3_北大肖臻《区块链技术与应用》_readme.md\":\"BRg90L9F\",\"tech-learning_web3_北大肖臻《区块链技术与应用》_笔记01-课程简介.md\":\"fUzJl1Ni\",\"tech-learning_web3_北大肖臻《区块链技术与应用》_笔记02-btc-密码学原理.md\":\"BUiPD7H4\",\"tech-learning_web3_北大肖臻《区块链技术与应用》_笔记03-btc-数据结构.md\":\"CPnbZdkJ\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-CN\",\"dir\":\"ltr\",\"title\":\"kenstant的博客\",\"description\":\"kenstant的博客\",\"base\":\"/blogs/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[],\"sidebar\":[],\"aside\":true,\"search\":{\"provider\":\"local\"},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/kenstant\"}],\"footer\":{\"message\":\"我与我周旋久，宁做我\",\"copyright\":\"Copyright © 2025\"},\"editLink\":false,\"lastUpdatedText\":\"上次更新时间\",\"returnToTopLabel\":\"返回顶部\",\"appearance\":true,\"externalLinkIcon\":true},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false,\"additionalConfig\":{}}");</script>
    
  </body>
</html>