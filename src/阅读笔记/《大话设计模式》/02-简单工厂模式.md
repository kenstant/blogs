## 简单工厂模式

### 1. 需求

**做一个计算器，实现功能: 加减乘除**。



### 2. 实现

#### 2.1 第一版代码

```java
package design_pattern.chap1.v1;

import java.util.Scanner;

public class CalculatorV1 {
    public static void main(String[] args) {
        Scanner sc = new Scanner(System.in);
        System.out.println("请输入数字a:");
        String a = sc.nextLine();
        System.out.println("请选择运算符号(+、-、*、/):");
        String b = sc.nextLine();
        System.out.println("请输入数字c:");
        String c = sc.nextLine();
        double d = 0d;
        if (b.equals("+")) {
            d = Double.parseDouble(a) + Double.parseDouble(c);
        }
        if (b.equals("-")) {
            d = Double.parseDouble(a) - Double.parseDouble(c);
        }
        if (b.equals("*")) {
            d = Double.parseDouble(a) * Double.parseDouble(c);
        }
        if (b.equals("/")) {
            d = Double.parseDouble(a) / Double.parseDouble(c);
        }
        System.out.println("结果是: " + d);
    }
}
```

- 缺点：
  - 变量命名不规范。
  - 判断分支如上写法会导致每次都多做三次无用的判断。
  - 除法时，c可能为0，没做处理。
  - 大量重复的`Double.parseDouble()`代码。



#### 2.2 第二版代码

```java
package design_pattern.chap1.v2;

import java.util.Scanner;

public class CalculatorV2 {
    public static void main(String[] args) {
        try {
            Scanner sc = new Scanner(System.in);
            System.out.println("请输入数字a:");
            double numberA = Double.parseDouble(sc.nextLine());
            System.out.println("请选择运算符号(+、-、*、/):");
            String strOperator = sc.nextLine();
            System.out.println("请输入数字b:");
            double numberB = Double.parseDouble(sc.nextLine());
            double result = 0d;
            switch (strOperator) {
                case "+":
                    result = numberA + numberB;
                    break;
                case "-":
                    result = numberA - numberB;
                    break;
                case "*":
                    result = numberA * numberB;
                    break;
                case "/":
                    result = numberA / numberB;
                    break;
            }
            System.out.println("结果是: " + result);
        } catch (Exception e) {
            System.out.println("您的输入有错:" +  e);
        }
    }
}
```

以上代码已经可以完成基本需求，但是不能称为好。



#### 什么是好的程序

- 可维护
- 可扩展
- 可复用
- 灵活性好



#### 2.3 第三版代码

```java
package design_pattern.chap1.v3;

public class Operation {
    public static double getResult(double numberA, double numberB, String operate) {
        double result = 0d;
        switch (operate) {
            case "+":
                result = numberA + numberB;
                break;
            case "-":
                result = numberA - numberB;
                break;
            case "*":
                result = numberA * numberB;
                break;
            case "/":
                result = numberA / numberB;
                break;
            // 其他操作...
        }
        return result;
    }
}
```



```java
package design_pattern.chap1.v3;

import java.util.Scanner;

public class CalculatorV3 {
    public static void main(String[] args) {
        try {
            Scanner sc = new Scanner(System.in);
            System.out.println("请输入数字a:");
            double numberA = Double.parseDouble(sc.nextLine());
            System.out.println("请选择运算符号(+、-、*、/):");
            String strOperator = sc.nextLine();
            System.out.println("请输入数字b:");
            double numberB = Double.parseDouble(sc.nextLine());
            // 调用改造后的代码
            double result = Operation.getResult(numberA, numberB, strOperator);
            System.out.println("结果是: " + result);
        } catch (Exception e) {
            System.out.println("您的输入有错:" +  e);
        }
    }
}
```

以上代码已经足够好了，但是如果需要在`Operation`类中新加`平方根运算`，在做需求时不小心改动了已有的代码，肯定会导致bug，我们需要避免这种情况。



#### 2.4 第四版代码：简单工厂模式

```java
package design_pattern.chap1.v4;

public abstract class Operation {
    public double getResult(double numberA, double numberB) {
        return 0d;
    }
}
```

```java
package design_pattern.chap1.v4;

public class Add extends Operation{
    @Override
    public double getResult(double numberA, double numberB) {
        return numberA + numberB;
    }
}
```

```java
package design_pattern.chap1.v4;

public class Sub extends Operation{
    @Override
    public double getResult(double numberA, double numberB) {
        return numberA - numberB;
    }
}
```

```java
package design_pattern.chap1.v4;

public class Mul extends Operation{
    @Override
    public double getResult(double numberA, double numberB) {
        return numberA * numberB;
    }
}
```

```java
package design_pattern.chap1.v4;

public class Div extends Operation{
    @Override
    public double getResult(double numberA, double numberB) {
        if (numberB == 0) {
            System.out.println("除数不能为0");
            throw new ArithmeticException();
        }
        return numberA / numberB;
    }
}
```

```java
package design_pattern.chap1.v4;

public class OperationFactory {
    public static Operation createOperate(String operate) {
        switch (operate) {
            case "+":
                return new Add();
            case "-":
                return new Sub();
            case "*":
                return new Mul();
            case "/":
                return new Div();
            // 其他操作...
        }
        return null;
    }
}
```

```java
package design_pattern.chap1.v4;

import java.util.Scanner;

public class CalculatorV4 {
    public static void main(String[] args) {
        try {
            Scanner sc = new Scanner(System.in);
            System.out.println("请输入数字a:");
            double numberA = Double.parseDouble(sc.nextLine());
            System.out.println("请选择运算符号(+、-、*、/):");
            String strOperator = sc.nextLine();
            System.out.println("请输入数字b:");
            double numberB = Double.parseDouble(sc.nextLine());
            // 调用改造后的代码
            Operation operation = OperationFactory.createOperate(strOperator);
            double result = operation.getResult(numberA, numberB);
            System.out.println("结果是: " + result);
        } catch (Exception e) {
            System.out.println("您的输入有错:" +  e);
        }
    }
}
```



