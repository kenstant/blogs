import{_ as i,c as a,o as t,al as e}from"./chunks/framework.6-m_a-od.js";const c=JSON.parse('{"title":"接口耗时问题排查","description":"","frontmatter":{"title":"接口耗时问题排查","date":"2024-12-28T12:41:01.000Z"},"headers":[],"relativePath":"tech-learning/practice/接口耗时问题排查.md","filePath":"技术学习/工作实践/接口耗时问题排查.md","lastUpdated":1764513386000}'),n={name:"tech-learning/practice/接口耗时问题排查.md"};function l(h,s,k,p,r,d){return t(),a("div",null,[...s[0]||(s[0]=[e(`<br><h2 id="接口性能耗时排查" tabindex="-1">接口性能耗时排查 <a class="header-anchor" href="#接口性能耗时排查" aria-label="Permalink to “接口性能耗时排查”">​</a></h2><h3 id="_1-使用arthas辅助排查" tabindex="-1">1. 使用Arthas辅助排查 <a class="header-anchor" href="#_1-使用arthas辅助排查" aria-label="Permalink to “1. 使用Arthas辅助排查”">​</a></h3><blockquote><p><code>Arthas</code>的<a href="https://arthas.aliyun.com/" target="_blank" rel="noreferrer">官方文档</a>地址：<a href="https://arthas.aliyun.com/" target="_blank" rel="noreferrer">https://arthas.aliyun.com/</a></p></blockquote><h4 id="_1-1-下载并启动arthas" tabindex="-1">1.1 下载并启动Arthas <a class="header-anchor" href="#_1-1-下载并启动arthas" aria-label="Permalink to “1.1 下载并启动Arthas”">​</a></h4><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 下载到当前目录下</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -O</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://arthas.aliyun.com/arthas-boot.jar</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启动</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">java</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -jar</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> arthas-boot.jar</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 等到出现 类似 [1]: 12345 /home/admin/example/demo.jar 这种的列表时，输入[]中的序号后按回车即可监听到目标 Java进程，见到如下命令行即可输入 arthas 的各种命令</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[arthas@12345]$ </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 退出arthas,用完arthas后，输入 stop 后按回车 即可。否则 arthas会在后台继续运行。</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[arthas@12345]$ stop</span></span></code></pre></div><ul><li><code>curl</code>参数 <ul><li><code>-O</code>：（大写字母O）使用远程文件的原始名称保存文件。</li><li><code>-o</code>：（小写字母o）可以指定输出文件名，例如<code>curl -o output.txt http://example.com/file.txt</code>。</li></ul></li></ul><h4 id="_1-2-使用trace命令" tabindex="-1">1.2 使用<code>trace</code>命令 <a class="header-anchor" href="#_1-2-使用trace命令" aria-label="Permalink to “1.2 使用trace命令”">​</a></h4><blockquote><p>使用情况：<strong>明确知道某个方法很慢，但不清楚具体是方法内哪段代码慢。</strong></p></blockquote><ul><li>作用：输出方法内部的每个子方法的耗时。</li><li>注意：每次只能跟踪一级方法的调用链路。</li></ul><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 根据调用方法耗时过滤,超过200毫秒的打印出来，捕捉10次</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">trace</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> org.redisson.spring.data.connection.RedissonConnection</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;#cost &gt; 200&#39;</span></span></code></pre></div><ul><li>参数解析 <ul><li><code>-n 10</code>：指定捕捉结果的次数，默认<code>100</code>次。</li><li><code>&#39;#cost &gt; 100&#39;</code>：捕捉<code>RedissonConnection类</code>的<code>get方法</code>耗时超过<code>200ms</code>的调用。</li></ul></li><li>结束<code>trace</code>命令 <ul><li>如果收集到足够次数会自动结束本次<code>trace</code>。</li><li>如果要手动结束，按下<code>Q</code>或者<code>Ctrl + C</code>也可以结束本次<code>trace</code>。</li><li>结束本次trace后，输入<code>reset后按回车</code>取消对类和方法的增强，否则影响性能。</li></ul></li></ul><blockquote><p>写笔记时已经没有想要的例子，给出如下结果做分析，体会其过程。</p></blockquote><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[arthas@1452252]$ trace org.redisson.spring.data.connection.RedissonConnection get -n 10 </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;#cost &gt; 2&#39;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Press</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Q</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> or</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Ctrl+C</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> abort.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Affect(class</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> count:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> method</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> count:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) cost in 524 ms, listenerId: 1</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">---ts</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">2024-12-28 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">13:11:30.609</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">thread_name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">http-nio-8090-exec-123;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">21741;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">is_daemon</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">true;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">priority</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">5;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">TCCL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">org.springframework.boot.web.embedded.tomcat.TomcatEmbeddedWebappClassLoader@503f91c3</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">---[4.702433ms]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> org.redisson.spring.data.connection.RedissonConnection:get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">---[81.17%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 3.817142ms ] org.redisson.spring.data.connection.RedissonConnection:read() </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#484</span></span></code></pre></div><ul><li>结果分析 <ul><li>一般会把耗时最长的方法标红显示。</li><li>上例可以看到是 <code>RedissonConnection</code>的<code>get</code>方法耗时最长。</li><li>接着就是对耗时最长的方法<code>进行优化</code>或者<code>进一步排查</code>，进一步排查时可以继续使用<code>trace</code>命令找到其子方法的耗时。</li></ul></li></ul>`,15)])])}const g=i(n,[["render",l]]);export{c as __pageData,g as default};
